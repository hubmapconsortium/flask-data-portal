{% extends 'pages/base.html' %}

{% block extra_stylesheets %}
  <link rel="stylesheet" href="https://unpkg.com/@hms-dbmi-bgm/react-workflow-viz@0.1.0/dist/react-workflow-viz.min.css">
  <link rel="stylesheet" href="https://unpkg.com/vitessce@0.0.19/umd/main.css">

{% endblock %}

{% block title %}
  <div class="row">
    <div class="col">
      <h1>{% block title_text %}{{ entity['description'] }}{% endblock %}</h1>
    </div>
    <div class="col">
      <div>Type: {{ type }}</div>
      <h2>{{ entity['display_doi'] }}</h2>
    </div>
  </div>
{% endblock %}

{% block content %}
  {% block details_base_content %}
    <div class="row">
      <div class="col">
        <dl>
          <dt>Contributor</dt>
          <dd>{{ entity['provenance_user_displayname'] }} ({{ entity['provenance_user_email'] }})</dd>

          <dt>Group</dt>
          <dd>{{ entity['provenance_group_name'] }}</dd>
        </dl>
      </div>

      <div class="col">
        <dl>
          <dt>Created</dt>
          <dd>{{ entity['created'] }}</dd>

          <dt>Modified</dt>
          <dd>{{ entity['modified'] }}</dd>
        </dl>
        <!--
          WARNING: UUID in API response seems to be wrong.
          https://github.com/hubmapconsortium/entity-api/issues/19
        -->
        <p><a href="{{ url_for('routes.details_ext', type=type, uuid=uuid, ext='json') }}">Raw JSON</a></p>
      </div>
    </div>

    {{ details_html|safe }}

    <div id="prov-vis">Provenance placeholder</div>
    <div id="vitessce">Vitessce placeholder</div>
  {% endblock %}
{% endblock %}

{% block extra_scripts %}
  <script src="https://unpkg.com/react@16/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/@hubmap/prov-vis@v0.0.1/umd/@hubmap/prov-vis.min.js"></script>
  <script src="https://unpkg.com/vitessce@0.0.19/umd/vitessce.min.js"></script>

  <script>
    hubmapProvVis.renderProvVis('prov-vis', {{ provenance|tojson }});
    vitessce.validateAndRender(
      {
        "description": "Multiplexed imaging of high-density libraries of RNAs with MERFISH and expansion microscopy",
        "layers": [
          {
            "name": "cells",
            "type": "CELLS",
            "url": "https://s3.amazonaws.com/vitessce-data/0.0.18/reorganize_folders/wang/wang.cells.json"
          },
          {
            "name": "molecules",
            "type": "MOLECULES",
            "url": "https://s3.amazonaws.com/vitessce-data/0.0.18/reorganize_folders/wang/wang.molecules.json"
          },
          {
            "name": "genes",
            "type": "GENES",
            "url": "https://s3.amazonaws.com/vitessce-data/0.0.18/reorganize_folders/wang/wang.genes.json"
          }
        ],
        "name": "Wang",
        "public": true,
        "responsiveLayout": {
          "columns": {
            "600": [0, 4, 6],
            "800": [0, 6, 8],
            "1000": [0, 8, 10],
            "1200": [0, 10, 12],
            "1400": [0, 12, 14]
          },
          "components": [
            {
              "component": "spatial",
              "props": {
                "view": {
                  "zoom": -1,
                  "target": [0, 0, 0]
                },
                "moleculeRadius": 2
              },
              "x": 0, "y": 0, "h": 2
            },
            {
              "component": "genes",
              "x": 1, "y": 0, "h": 2
            }
          ]
        }
      },
      'vitessce', // Target ID
      100 // Row-height in grid
    );
  </script>
{% endblock %}
